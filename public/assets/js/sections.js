!function(){var e={7757:function(e,t,r){e.exports=r(5666)},305:function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.percentNds,r=e.contractingPercent,n=function(){return 0==$("#autoCalcState").is(":checked")},o=$("#selfPriceNds").ddrCalc([{selector:"#genPriceNds",method:"percent",percent:r,stat:n},{selector:"#genPrice",method:"percent",percent:r,middleware:[function(e,r){return r("nds",$("#genPriceNds").val(),t,!0)},!1],stat:n}]),i=$("#selfPrice").ddrCalc([{selector:"#genPrice",method:"percent",percent:r,stat:n},{selector:"#genPriceNds",method:"percent",percent:r,middleware:[function(e,r){return r("nds",$("#genPrice").val(),t)},!1],stat:n}]),a=$("#genPriceNds").ddrCalc([{selector:"#genPrice",method:"nds",percent:t,reverse:!0,stat:n},{selector:"#selfPriceNds",method:"percent",percent:r,reverse:!0,stat:n},{selector:"#selfPrice",method:"percent",percent:r,reverse:!0,middleware:[function(e,r){return r("nds",$("#selfPriceNds").val(),t,!0)},!1],stat:n}]),s=$("#genPrice").ddrCalc([{selector:"#genPriceNds",method:"nds",percent:t,stat:n},{selector:"#selfPrice",method:"percent",percent:r,reverse:!0,stat:n},{selector:"#selfPriceNds",method:"percent",percent:r,reverse:!0,middleware:[function(e,r){return r("nds",$("#selfPrice").val(),t)},!1],stat:n}]);return{selfPriceNds:o,selfPrice:i,genPriceNds:a,genPrice:s}}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.percentNds,r=e.contractingPercent,n=function(){return 0==$("#autoCalcState").is(":checked")},o=$("#selfPriceNds").ddrCalc([{selector:"#subPriceNds",method:"percent",percent:r,reverse:!0,stat:n},{selector:"#subPrice",method:"percent",percent:r,reverse:!0,middleware:[function(e,r){return r("nds",$("#subPriceNds").val(),t,!0)},!1],stat:n}]),i=$("#selfPrice").ddrCalc([{selector:"#subPrice",method:"percent",percent:r,reverse:!0,stat:n},{selector:"#subPriceNds",method:"percent",percent:r,reverse:!0,middleware:[function(e,r){return r("nds",$("#subPrice").val(),t)},!1],stat:n}]),a=$("#subPriceNds").ddrCalc([{selector:"#subPrice",method:"nds",percent:t,reverse:!0,stat:n},{selector:"#selfPriceNds",method:"percent",percent:r,stat:n},{selector:"#selfPrice",method:"percent",percent:r,middleware:[function(e,r){return r("nds",$("#selfPriceNds").val(),t,!0)},!1],stat:n}]),s=$("#subPrice").ddrCalc([{selector:"#subPriceNds",method:"nds",percent:t,stat:n},{selector:"#selfPrice",method:"percent",percent:r,stat:n},{selector:"#selfPriceNds",method:"percent",percent:r,middleware:[function(e,r){return r("nds",$("#selfPrice").val(),t)},!1],stat:n}]);return{selfPriceNds:o,selfPrice:i,subPriceNds:a,subPrice:s}}r.r(t),r.d(t,{calcGencontracting:function(){return o},calcSubcontracting:function(){return n},contentSelection:function(){return x},contextMenu:function(){return y},getLastnameFromApplicant:function(){return P},selectionsList:function(){return S},showSelections:function(){return l}});var i=r(7757),a=r.n(i);function s(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){s(i,n,o,a,c,"next",e)}function c(e){s(i,n,o,a,c,"throw",e)}a(void 0)}))}}function l(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;return!_.isNull(r)&&(n=$(e).ddrTooltip({placement:"right-start",tag:"noscroll noopen",offset:[0,0],minWidth:"200px",minHeight:"40px",duration:[200,200],trigger:"mouseenter focus",wait:{iconHeight:"40px"},onShow:(t=c(a().mark((function e(t){var n,i,s,l,d,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.reference,t.popper,t.show,t.hide,t.destroy,i=t.waitDetroy,t.setContent,s=t.setData,t.setProps,e.next=3,axiosQuery("get","site/contracts/contract_selections",{contract_id:r},"json");case 3:if(l=e.sent,d=l.data,u=l.error,l.status,l.headers,!u){e.next=13;break}return $.notify("Ошибка! Не удалось загрузить список подборок!","error"),console.log(u.message),i(),e.abrupt("return");case 13:return e.next=15,s(d);case 15:i(),$.removeContractFromSelection=function(){var e=c(a().mark((function e(t,i){var s,c,l,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(t).ddrWait({iconHeight:"20px"}),e.next=3,axiosQuery("put","site/selections/remove_contract",{contractId:r,selectionId:i},"json");case 3:if(s=e.sent,c=s.data,l=s.error,s.status,s.headers,!l){e.next=12;break}return $.notify("Ошибка! Не удалось удалить подборку из договора!","error"),console.log(l.message),e.abrupt("return");case 12:c&&($(t).closest("li").remove(),i==o.value&&$("#contractsTable").find('[contractid="'+r+'"]').remove(),d=$(n).text().trim(),$.notify("Объект: "+d+" удален из подборки!"));case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();case 17:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}),$(document).one("keydown",(function(e){var t;27==e.keyCode&&null!=(null===(t=n)||void 0===t?void 0:t.destroy)&&n.destroy()})),n)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){f(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function h(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){p(i,n,o,a,s,"next",e)}function s(e){p(i,n,o,a,s,"throw",e)}a(void 0)}))}}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,o,i=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new g(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function g(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return g=function(e){this.s=e,this.n=e.next},g.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new g(e)}function y(e,t,r,n,o,i,s,c,l){var d,f;$.contractContextMenu=function(p,m,g,y,x,w,C,k,S,P,T,L,I,A,D,j,O,F,E,M,N){var H,B,Q,W=p.target,z=p.closeOnScroll,K=p.onContextMenu,R=p.onCloseContextMenu,G=p.changeAttrData,q=p.buildTitle,U=p.setStyle,Z=(p.setCloseSubNavTOut,!!$(W.pointer).closest("[ddrtabletd]").hasAttr("commonlist")||!1),Y=!!$(W.pointer).closest("[ddrtabletd]").hasAttr("deptcheck")||!1,V=!!$(W.pointer).closest("[ddrtabletd]").children().length,J=!!$(W.pointer).closest("[ddrtabletd]").hasAttr("contextedit"),X=!$(W.pointer).closest("[ddrtabletd]").attr("contextedit"),ee=!!$(W.pointer).closest("[ddrtabletd]").find("[edittedplace]").hasClass("select-text")||!!$(W.pointer).closest("[ddrtabletd]").find("[edittedblock]").length||!!$("#contractsTable").find("[ddrtabletd].selected").length&&$(W.pointer).closest("[ddrtabletd]").hasClass("selected"),te=!!$(W.pointer).closest("[ddrtabletd]").hasAttr("editacts")||!1,re={};(ee||$(W.pointer).closest("[ddrtabletd]").hasClass("selected")||$(W.pointer).closest("[ddrtabletd]").find("[edittedplace]").hasClass("select-text"))&&U({mainMinHeight:"30px"});var ne=!0,oe=pregSplit($(W.pointer).closest("[ddrtabletd]").attr("contextedit"));if($(W.pointer).closest("[ddrtabletd]").find("[calcprice]").length){var ie=v(pregSplit($(W.pointer).closest("[ddrtabletd]").find("[calcprice]").attr("calcprice")||null),4),ae=ie[2],se=ie[3];-1!==["price_gen","price_gen_nds"].indexOf(oe[1])&&se||-1!==["price_sub","price_sub_nds"].indexOf(oe[1])&&ae?ne=!1:-1!==["price","price_nds","gen_percent","price_avvr","price_avvr_nds","price_pir","price_pir_nds","price_smr","price_pnr"].indexOf(oe[1])||ae||se||(ne=!1)}else void 0!==oe&&-1!==["date_report_from"].indexOf(oe[1])&&(ne=!1);K((function(){var r,n;e.value=!0,ee||$("#contractsList").find("[editted]").each((function(e,t){le(t)})),0==$(W.pointer).closest("[ddrtabletd]").hasClass("selected")&&$("#contractsList").find("[ddrtabletd].selected").removeClass("selected"),Z&&0==$(W.selector).hasAttr("contractselected")&&($("#contractsTable").find("[contractselected]").removeClass("ddrtable__tr-selected").removeAttrib("contractselected"),o.value=W.selector,t.add($(W.selector).attr("contractid"))),Z||$("#contractsTable").find("[contractselected]").removeClass("ddrtable__tr-selected").removeAttrib("contractselected"),ee||(removeSelection(),$("#contractsTable").find("[edittedplace].select-text").removeClass("select-text")),$("#contractsTable").find("[contractselected]").length?$("#contractsTable").find("[contractselected]").each((function(e,t){re[$(t).attr("contractid")]=!!$(t).find("[pinnedicon]").children("i").length})):re[$(W.selector).attr("contractid")]=!!$(W.selector).find("[pinnedicon]").children("i").length,Q=Object.values(re).every((function(e){return!0===e}))?1:Object.values(re).every((function(e){return!1===e}))?-1:0,null!=(null===(r=d)||void 0===r?void 0:r.destroy)&&d.destroy(),null!=(null===(n=f)||void 0===n?void 0:n.destroy)&&f.destroy()})),R((function(){e.value=!1}));var ce=(null===(H=t.items)||void 0===H?void 0:H.length)||0;function le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_.isNull(e)||($(e).removeClass("editted"),$(e).find("[edittedwait]").remove(),$(e).find("[edittedplacer]").remove(),$(e).find("[edittedblock]").remove(),$(e).removeAttrib("editted"),$("#contractsTable").find("[replacer]").setAttrib("replacer",""),$("#contractsTable").find('[replacer]:contains("-")').siblings("strong:not(:hidden)").setAttrib("hidden"),$("#contractsTable").find("[replacer]:empty").siblings("strong:not(:hidden)").setAttrib("hidden"))}return z("#contractsList"),[{name:q(ce,"Чат договора","Cообщение в чаты"),countLeft:ce>1?ce:null,countRight:1==ce?k:null,countOnArrow:!0,visible:Z&&j&&!ee,sort:1,onClick:function(){if(1==ce)ddrPopup({title:'<small class="fz12px color-gray">Чат договора:</small> «'+w+"»",width:800,buttons:["Закрыть"],winClass:"ddrpopup_chat"}).then((function(e){e.state;var t=e.wait,r=(e.setTitle,e.setButtons,e.loadData,e.setHtml);e.setLHtml,e.dialog,e.close,e.onScroll,e.disableButtons,e.enableButtons,e.setWidth;t(),axiosQuery("get","site/contracts/chat",{contract_id:m}).then((function(e){var o=e.data,i=e.error;e.status,e.headers;if(i)return $.notify("Не удалось загрузить чат!","error"),void console.log(null==i?void 0:i.message,null==i?void 0:i.errors);r(o,(function(){n.value=!1;var e=$("#contractsSearchField").val();if(e){var r=ddrSplit(e,"+");r&&(_.isArray(r)||(r=[r]),$.each(r,(function(e,t){if(""===t||null===t)return!0;var r=$("#chatMessageList").find('p:icontains("'+t+'"), strong:icontains("'+t+'")');r&&$.each(r,(function(e,r){var n;$(r).html($(r).text().replace(new RegExp("("+((t+"").replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(n||"")+"-]","g"),"\\$&")+")"),"gi"),'<span class="highlight">$1</span>'))}))})))}t(!1),$(".chat__message").tripleTap((function(e){selectText(e)}));var o=$("#chatMessageList").outerHeight(),i=$("#chatMessageList")[0].scrollHeight;$("#chatMessageList").scrollTop(i-o),$("#chatMessageBlock").focus(),$("#chatMessageBlock").ddrInputs("change",(function(){var e=getContenteditable("#chatMessageBlock");e&&!n.value?(n.value=!0,$("#chatSendMesageBtn").ddrInputs("enable")):!e&&n.value&&(n.value=!1,$("#chatSendMesageBtn").ddrInputs("disable"))}))}))})).catch((function(e){console.log(e)}))}));else{ddrPopup({title:"Отправить сообщение в выбранные договоры",width:500,html:'<p class="d-block mb5px fz14px color-darkgray">Сообщение:</p><div class="textarea normal-textarea w100" id="sendMessagesToManyContractsField"><textarea name="" rows="10" class="w100"></textarea></div>',buttons:["Закрыть",{title:"Отправить",variant:"blue",action:"sendMessagesToManyContracts",disabled:1,id:"sendMessagesToManyContractsBtn"}],winClass:"ddrpopup_chat"}).then((function(e){e.state;var r=e.wait,n=(e.setTitle,e.setButtons,e.loadData,e.setHtml,e.setLHtml,e.dialog,e.close),o=e.onClose,i=(e.onScroll,e.disableButtons,e.enableButtons,e.setWidth,!0);$("#sendMessagesToManyContractsField").find("textarea").focus(),$("#sendMessagesToManyContractsField").ddrInputs("change",(function(e){$(e).val()&&i?($("#sendMessagesToManyContractsBtn").ddrInputs("enable"),i=!1):$(e).val()||i||($("#sendMessagesToManyContractsBtn").ddrInputs("disable"),i=!0)})),$.sendMessagesToManyContracts=function(){r(),$("#sendMessagesToManyContractsBtn").ddrInputs("disable");var e=$("#sendMessagesToManyContractsField").find("textarea").val(),i=new AbortController;axiosQuery("put","site/contracts/chats",{contractIds:t.items,message:e},"json",i).then((function(e){var t=e.data,o=e.error;e.status,e.headers;o?$.notify("Ошибка отправки сообщения!","error"):t?-1==t?$.notify("Сообщение не было разослано!","info"):($.notify("Сообщение успешно отправлено во все чаты выбранных договоров!"),n()):($.notify("Не удалось отправить сообщение в чаты выбранных договоров!","error"),r(!1))})).catch((function(e){console.log(e)})),o((function(){i.abort()}))}}))}}},{name:"Отправить в архив",visible:Z&&L&&!T&&!ee,countLeft:ce>1?ce:null,sort:5,onClick:function(){var e="";e+="<div>",1==ce?(e+='<p class="fz14px color-darkgray text-start">Номер объекта: <span class="color-black">'+x+"</span></p>",e+='<p class="fz14px color-darkgray text-start">Название/заявитель: <span class="color-black">'+w+"</span></p>",e+='<p class="fz18px color-red mt15px">Вы действительно хотите отправить договор в архив?</p>'):ce>1&&(e+='<p class="fz18px color-red mt15px">'+q(ce,"Вы действительно хотите отправить # % в архив?",["договор","договора","договоров"])+"</p>"),e+="</div>",ddrPopup({width:400,html:e,buttons:["ui.cancel",{title:"Отправить",variant:"red",action:"contractToArchiveAction"}],centerMode:!0,winClass:"ddrpopup_dialog"}).then((function(e){var n=e.close,o=e.wait;$.contractToArchiveAction=function(e){o(),axiosQuery("post","site/contracts/to_archive",{contractIds:t.items},"json").then((function(e){var t=e.data,o=(e.error,e.status,e.headers,1==ce?" "+x+" "+w:"");t?(y||S?l((function(){r(W)})):r(W),$.notify(q(ce,"%"+o+" успешно отправлен в архив!","# % успешно отправлены в архив!",["Договор","договора","договоров"]))):$.notify(q(ce,"Ошибка! %"+o+" не был отправлен в архив!","Ошибка! % не были отправлены в архив!",["договор","договора","договоров"]),"error"),n()}))}}))}},{name:"Вернуть в работу",visible:Z&&F&&T&&!ee,countLeft:ce>1?ce:null,sort:5,onClick:function(){ddrPopup({width:400,html:'<p class="fz18px color-green">'+q(ce,"Вы действительно хотите вернуть # % в работу?",["договор","договора","договоров"])+"</p>",buttons:["ui.cancel",{title:"Вернуть",variant:"blue",action:"returnContractToWorkBtn"}],centerMode:!0,winClass:"ddrpopup_dialog"}).then((function(e){var n=e.close,o=e.wait;$.returnContractToWorkBtn=function(e){o(),axiosQuery("post","site/contracts/to_work",{contractIds:t.items},"json").then((function(e){var t=e.data,o=(e.error,e.status,e.headers,1==ce?" "+x+" "+w:"");t?(y||S?l((function(){r(W)})):r(W),$.notify(q(ce,"%"+o+" успешно возвращен в работу!","# % успешно возвращены в работу!",["Договор","договора","договоров"]))):$.notify(q(ce,"Ошибка! %"+o+" не был возвращен в работу!","Ошибка! # % не были возвращены в работу!",["Договор","договора","договоров"]),"error"),n()}))}}))}},{name:"Добавить в подборку",visible:Z&&!ee,countLeft:ce>1?ce:null,sort:2,load:{url:"site/contracts/selections_to_choose",params:{contractIds:t.items},method:"get",map:function(e){return{name:e.title,disabled:!!e.choosed,onClick:function(r){return h(a().mark((function r(){var n,o,i,s,c,l,d,u,f;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e.id,o=processNotify(q(ce,"Добавление # % в подборку...",["договора","договоров","договоров"])),1==(i=t.items).length?(s={contractId:i[0],selectionId:n},c="add_contract"):(s={contractIds:i,selectionId:n},c="add_contracts"),r.next=6,axiosQuery("put","site/selections/"+c,s);case 6:if(l=r.sent,d=l.data,u=l.error,l.status,l.headers,!u){r.next=15;break}return o.error({message:"Ошибка добавления в подборку!"}),console.log(null==u?void 0:u.message,u.errors),r.abrupt("return");case 15:d&&(f=1==ce?" "+x+" "+w:"",o.done({message:q(ce,"%"+f+" успешно добавлен в подборку!","# % успешно добавлены в подборку!",["Договор","договора","договоров"])}));case 16:case"end":return r.stop()}}),r)})))()}}}}},{name:"Удалить из подборки",enabled:M,visible:Z&&y&&!ee,countLeft:ce>1?ce:null,sort:4,onClick:function(){var e,n,o=processNotify(q(ce,"Удаление # % из подборки...",["договора","договоров","договоров"])),i=t.items;1==i.length?(e={contractId:i[0],selectionId:y},n="remove_contract"):(e={contractIds:i,selectionId:y},n="remove_contracts"),axiosQuery("put","site/selections/"+n,e).then((function(e){e.data;var t=e.error,n=(e.status,e.headers,1==ce?" "+x+" "+w:"");t?(o.error({message:"Ошибка удаления договора"+n+" из подборки!"}),console.log(null==t?void 0:t.message,t.errors)):(o.done({message:q(ce,"%"+n+" успешно удален из подборки!","# % успешно удалены из подборки!",["Договор","договора","договоров"])}),l((function(){r(W),$("[selectionsbtn]").ddrInputs("enable")})))}))}},{name:"Создать новую подборку",sort:3,visible:Z&&!ee,countLeft:ce>1?ce:null,onClick:function(){ddrPopup({title:"Создать подборку из выбранных договоров",width:500,html:'<p class="d-block mb5px fz14px color-darkgray">Название подборки:</p><div class="input normal-input normal-input-text w100"><input type="text" value="" id="selectionNameInput" placeholder="Введите текст" autocomplete="off" inpgroup="normal"><div class="normal-input__errorlabel noselect" errorlabel=""></div></div>',buttons:["Закрыть",{title:"Создать",variant:"blue",action:"createNewSelection",disabled:1,id:"createNewSelectionBtn"}],winClass:"ddrpopup_chat"}).then((function(e){e.state;var r=e.wait,n=(e.setTitle,e.setButtons,e.loadData,e.setHtml,e.setLHtml,e.dialog,e.close),o=e.onClose,i=(e.onScroll,e.disableButtons,e.enableButtons,e.setWidth,!0);$("#selectionNameInput").ddrInputs("change",(function(e){$(e).val()&&i?($("#createNewSelectionBtn").ddrInputs("enable"),i=!1):$(e).val()||i||($("#createNewSelectionBtn").ddrInputs("disable"),i=!0)})),$.createNewSelection=function(){r();var e=$("#selectionNameInput").val(),i=new AbortController;axiosQuery("post","site/selections/add_selection_from_contextmenu",{title:e,contractIds:t.items},"json",i).then((function(e){var t=e.data,o=e.error;e.status,e.headers;o?$.notify("Ошибка создания подборки!","error"):t?-1==t?($.notify("Подборка не была создана!","info"),r(!1)):($.notify(q(ce,"Поодборка с # % была успешна создана!",["договором","договорами","договорами"])),n()):($.notify("Не удалось создать подборку!","error"),r(!1))})).catch((function(e){console.log(e)})),o((function(){i.abort()}))}}))}},{name:"Отправить в другой отдел",enabled:ce>1||!!C&&(I&&g||A&&!g),hidden:T||!Z||ee,countLeft:ce>1?ce:null,sort:4,load:{url:"site/contracts/departments",params:{contractId:1==t.items.length?t.items[0]:null},method:"get",map:function(e){var r;return{name:1==(null==e||null===(r=e.info)||void 0===r?void 0:r.hide)?"".concat(null==e?void 0:e.name,' <small style="color: #c9c9c9;">(скрыт)</small>'):null==e?void 0:e.name,visible:!0,onClick:function(r){var n=r.text(),o=r.items().length,i=processNotify("Отправка договора в другой отдел...");axiosQuery("post","site/contracts/send",{contractIds:t.items,departmentId:e.id},"json").then((function(e){var t=e.data;e.error,e.status,e.headers;if(t){if(y||S){l((function(){}))}if(t.length){var r=1==ce?" "+x+" "+w:"",a=q(t.length,"# %"+r+" успешно отправлен в "+n+"!","# % успешно отправлены в "+n+"!",["договор","договора","договоров"]);i.done({message:a})}else i.error({message:"Ни один договор не был отправлен!"});1==ce&&0==o&&G(6,"0")}else i.error({message:"Ошибка! Договор не был отправлен!"})}))}}}}},{name:"Скрыть",visible:Z&&D&&g&&!T&&!ee,countLeft:ce>1?ce:null,sort:6,onClick:function(){ddrPopup({width:400,html:q(ce,'<p class="fz18px color-red">Вы действительно хотите скрыть # %?</p>',["договор","договора","договоров"]),buttons:["ui.cancel",{title:"Скрыть",variant:"red",action:"contractHide"}],centerMode:!0,winClass:"ddrpopup_dialog"}).then((function(e){var n=e.close,o=e.wait;$.contractHide=function(e){o(),axiosQuery("post","site/contracts/hide",{contractIds:t.items,departmentId:g},"json").then((function(e){var t=e.data,o=(e.error,e.status,e.headers,1==ce?" "+x+" "+w:"");t?(y||S?l((function(){r(W)})):r(W),$.notify(q(ce,"%"+o+" успешно скрыт!","# % успешно скрыты!",["Договор","договора","договоров"]))):$.notify(q(ce,"Ошибка! договор"+o+" не был скрыт!","Ошибка! договоры не были скрыты!"),"error"),n()}))}}))}},{name:V&&c?"Удалить чекбокс":!V&&s?"Добавить чекбокс":"",visible:Y&&!T&&(!V&&s||V&&c)&&!ee,sort:1,onClick:function(){return h(a().mark((function e(){var t,r,n,o,i,s,c,l,d,u,f,p,h,m,b,g,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=$(W.pointer).closest("[ddrtabletd]"),r=!!$(t).attr("edited"),n=$(t).attr("deptcheck"),o=pregSplit(n),i=v(o,3),s=i[0],c=void 0===s?null:s,l=i[1],d=void 0===l?null:l,u=i[2],f=void 0===u?null:u,p=$(t).ddrWait({iconHeight:"30px",bgColor:"#efe9f9"}),e.next=7,axiosQuery("post","site/contracts/step_checkbox",{contractId:c,departmentId:d,stepId:f,value:V},"json");case 7:if(h=e.sent,m=h.data,b=h.error,h.status,h.headers,!b){e.next=17;break}return console.log(b),$.notify("Ошибка! Не удалось "+(V?"удалить":"добавить")+" чекбокс!","error"),p.destroy(),e.abrupt("return");case 17:m&&(V?($(t).empty(),$.notify("Чекбокс успешно удален!")):(r?(g=generateCode("nnnnnnn"),y='<div class="checkbox normal-checkbox"><input type="checkbox" name="assigned_primary" id="checkbox'+g+'" inpgroup="normal" oninput="$.contractSetData(this, '+c+","+d+","+f+',1)"><label class="noselect" for="checkbox'+g+'"></label><label for="checkbox'+g+'" class="checkbox__label lh90 d-inline-block normal-checkbox__label noselect"></label><div class="normal-checkbox__errorlabel" errorlabel=""></div></div>',$(t).html(y)):$(t).html('<div class="checkbox-empty checkbox-empty-normal border-gray-400"></div>'),$.notify("Чекбокс успешно добавлен!")),p.destroy());case 18:case"end":return e.stop()}}),e)})))()}},{name:"Комментарии",visible:V&&Y&&!ee,sort:2,onClick:function(){return h(a().mark((function e(){var t,r,n,o,i,s,c,l,u,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=$(W.pointer).closest("[ddrtabletd]"),r=$(t).attr("deptcheck"),n=pregSplit(r),o=v(n,3),i=o[0],s=void 0===i?null:i,c=o[1],l=void 0===c?null:c,u=o[2],f=void 0===u?null:u,d=$(t).ddrTooltip({placement:"bottom",tag:"noscroll noopen",offset:[-5],minWidth:"200px",minHeight:"200px",duration:[200,200],trigger:"click",wait:{iconHeight:"40px"},onShow:function(){var e=h(a().mark((function e(t){var r,n,o,i,c,u,p,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.reference,n=t.popper,t.show,t.hide,t.destroy,o=t.waitDetroy,t.setContent,i=t.setData,t.setProps,e.next=3,axiosQuery("get","site/contracts/cell_comment",{contract_id:s,department_id:l,step_id:f},"json");case 3:return c=e.sent,u=c.data,c.error,c.status,c.headers,e.next=10,i(u);case 10:o(),p=$(n).find("#sendCellComment"),$(p).focus(),p[0].selectionStart=p[0].selectionEnd=p[0].value.length,$("#contractsList").one("scroll",(function(){var e;null!=(null===(e=d)||void 0===e?void 0:e.destroy)&&d.destroy()})),$(p).on("input",(function(){var e=this;clearTimeout(v),v=setTimeout(h(a().mark((function t(){var n,o,i,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=$(e).val(),t.next=3,axiosQuery("post","site/contracts/cell_comment",{contract_id:s,department_id:l,step_id:f,comment:n},"json");case 3:if(o=t.sent,i=o.data,c=o.error,o.status,o.headers,!c){t.next=12;break}return console.log(c),$.notify("Ошибка! Не удалось задать комментарий!","error"),t.abrupt("return");case 12:i&&(n?$(r).append('<div class="trangled trangled-top-right"></div>'):$(r).find(".trangled").remove());case 13:case"end":return t.stop()}}),t)}))),500)}));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onDestroy:function(){}});case 4:case"end":return e.stop()}}),e)})))()}},{name:"Редактировать",visible:1==ce&&Z&&(i||te&&E)&&J&&!ee,disabled:$(W.pointer).closest("[ddrtabletd]").hasAttr("editted")||X||!ne,sort:7,onClick:function(){return h(a().mark((function e(){var t,r,n,o,i,s,c,l,d,u,p,m,b,g,y,x,w,C,k,S,P,T,L,I,A;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$(W.pointer).closest("[ddrtabletd]"),r=$(t).attr("contextedit"),n=pregSplit(r),o=v(n,3),i=o[0],s=void 0===i?null:i,c=o[1],l=void 0===c?null:c,d=o[2],u=void 0===d?null:d,$("#contractsList").find("[editted]").each((function(e,t){le(t)})),$(".app").on(tapEvent+".unEditCell",(function(e){$(e.target).closest("[ddrtabletd]").hasAttr("editted")&&-1===[3,4].indexOf(u)||(le(t),$(".app").off(".unEditCell"))})),$(t).setAttrib("editted"),p=$(t).ddrWait({iconHeight:"30px",tag:"noscroll noopen edittedwait"}),-1===[1,2].indexOf(u)){e.next=31;break}return e.next=10,axiosQuery("get","site/contracts/cell_edit",{contract_id:s,column:l,type:u});case 10:if(m=e.sent,b=m.data,g=m.error,m.status,y=m.headers,!g){e.next=20;break}return $.notify("Ошибка редактирования ячейки!","error"),p.destroy(),console.log(null==g?void 0:g.message,g.errors),e.abrupt("return");case 20:x=y.price_nds||0,$(t).append(b),$(t).find("#edittedCellData").focus(),(w=$(t).find("#edittedCellData"))[0].selectionStart=w[0].selectionEnd=w[0].value.length,2==u&&($(t).find("#edittedCellData").number(!0,2,"."," "),C=$(t).find("#edittedCellData"),k=$(C).closest("[ddrtabletr]"),S=pregSplit($(t).find("[calcprice]").attr("calcprice")),P=v(S,4),T=P[1],L=P[2],I=P[3],A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(_.isNull(e))return!1;var r=$(k).find('[calcprice^="'+e+'|"], [calcprice="'+e+'"]');$(r).setAttrib("replacer",t),$(r).siblings("strong:hidden").removeAttrib("hidden")},L||I?L?"price"==l?B=$(C).ddrCalc([{selector:function(e){return A("price_nds",e)},method:"nds",numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("price_gen",e)},method:"percent",numberFormat:[2,"."," "],percent:T},{selector:function(e){return A("price_gen_nds",e)},method:"percent",percent:T,numberFormat:[2,"."," "],middleware:[function(e,t){return t("nds",e,x)},!1]}]):"price_nds"==l?B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"nds",reverse:!0,numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("price_gen",e)},method:"percent",numberFormat:[2,"."," "],percent:T,middleware:[function(e,t){return t("nds",e,x,!0)},!1]},{selector:function(e){return A("price_gen_nds",e)},method:"percent",percent:T,numberFormat:[2,"."," "]}]):"price_gen"==l?B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"percent",reverse:!0,numberFormat:[2,"."," "],percent:T},{selector:function(e){return A("price_nds",e)},method:"percent",reverse:!0,numberFormat:[2,"."," "],percent:T,middleware:[function(e,t){return t("nds",e,x)},!1]},{selector:function(e){return A("price_gen_nds",e)},method:"nds",percent:x,numberFormat:[2,"."," "]}]):"price_gen_nds"==l&&(B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"percent",reverse:!0,numberFormat:[2,"."," "],percent:T,middleware:[function(e,t){return t("nds",e,x,!0)},!1]},{selector:function(e){return A("price_nds",e)},method:"percent",reverse:!0,numberFormat:[2,"."," "],percent:T},{selector:function(e){return A("price_gen",e)},method:"nds",reverse:!0,percent:x,numberFormat:[2,"."," "]}])):I&&("price"==l?B=$(C).ddrCalc([{selector:function(e){return A("price_nds",e)},method:"nds",numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("price_sub",e)},method:"percent",reverse:!0,numberFormat:[2,"."," "],percent:T},{selector:function(e){return A("price_sub_nds",e)},method:"percent",reverse:!0,percent:T,numberFormat:[2,"."," "],middleware:[function(e,t){return t("nds",e,x)},!1]}]):"price_nds"==l?B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"nds",reverse:!0,numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("price_sub",e)},method:"percent",reverse:!0,numberFormat:[2,"."," "],percent:T,middleware:[function(e,t){return t("nds",e,x,!0)},!1]},{selector:function(e){return A("price_sub_nds",e)},method:"percent",reverse:!0,percent:T,numberFormat:[2,"."," "]}]):"price_sub"==l?B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"percent",numberFormat:[2,"."," "],percent:T},{selector:function(e){return A("price_nds",e)},method:"percent",numberFormat:[2,"."," "],percent:T,middleware:[function(e,t){return t("nds",e,x)},!1]},{selector:function(e){return A("price_sub_nds",e)},method:"nds",percent:x,numberFormat:[2,"."," "]}]):"price_sub_nds"==l&&(B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"percent",numberFormat:[2,"."," "],percent:T,middleware:[function(e,t){return t("nds",e,x,!0)},!1]},{selector:function(e){return A("price_nds",e)},method:"percent",numberFormat:[2,"."," "],percent:T},{selector:function(e){return A("price_sub",e)},method:"nds",reverse:!0,percent:x,numberFormat:[2,"."," "]}]))):"price"==l?B=$(C).ddrCalc([{selector:function(e){return A("price_nds",e)},method:"nds",numberFormat:[2,"."," "],percent:x}]):"price_nds"==l?B=$(C).ddrCalc([{selector:function(e){return A("price",e)},method:"nds",reverse:!0,numberFormat:[2,"."," "],percent:x}]):"price_avvr"==l?B=$(C).ddrCalc([{selector:function(e){return A("price_avvr_nds",e)},method:"nds",numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("avvr_nds_only",e)},method:"percent_only",numberFormat:[2,"."," "],percent:20}]):"price_avvr_nds"==l?B=$(C).ddrCalc([{selector:function(e){return A("price_avvr",e)},method:"nds",reverse:!0,numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("avvr_nds_only",e)},method:"percent_only",numberFormat:[2,"."," "],percent:20,reverse:!0}]):"price_pir"==l?B=$(C).ddrCalc([{selector:function(e){return A("price_pir_nds",e)},method:"nds",numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("pir_nds_only",e)},method:"percent_only",numberFormat:[2,"."," "],percent:20}]):"price_pir_nds"==l&&(B=$(C).ddrCalc([{selector:function(e){return A("price_pir",e)},method:"nds",reverse:!0,numberFormat:[2,"."," "],percent:x},{selector:function(e){return A("pir_nds_only",e)},method:"percent_only",numberFormat:[2,"."," "],percent:20,reverse:!0}]))),$(t).find("#edittedCellData").on("keypress.saveedittedcell",(function(e){13!=e.keyCode||e.shiftKey||($(t).find("[savecelldata]").trigger(tapEvent),$(t).find("#edittedCellData").off(".saveedittedcell"))})),$(t).off(".savecelldata"),$(t).one(tapEvent+".savecelldata","[savecelldata]",h(a().mark((function e(){var r,n,o,i,c,d,f,h,v,m,b,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$(t).closest("[ddrtabletr]"),n=$(r).find('[calcprice]:not([replacer=""])'),o={},n.length&&($.each(n,(function(e,t){var r=pregSplit($(t).attr("calcprice"));o[r[0]]=Number($(t).attr("replacer").replaceAll(" ","")),$(t).siblings("strong:hidden").removeAttrib("hidden")})),$.each(o,(function(e,t){$(r).find('[calcprice^="'+e+'|"], [calcprice="'+e+'"]').html($.number(t,2,"."," "))}))),$(this).hide(),p.on(),i=new RegExp("price_?"),c=$(t).find("#edittedCellData").val(),d=i.test(l)?Number(c):c,f=$(t).find("[edittedplace]").attr("edittedplace"),e.next=10,axiosQuery("post","site/contracts/cell_edit",{contract_id:s,column:l,type:u,data:d,addict_colums:o},"json");case 10:h=e.sent,v=h.data,m=h.error,h.status,h.headers,m&&(p.off(),$.notify("Ошибка сохранения ячейки!","error"),console.log(null==m?void 0:m.message,m.errors)),v&&($.notify("Сохранено!"),g="power"==l&&0==d?"-":d||f,$(t).find("[edittedplace]").text(g),p.destroy(),2==u&&($(t).find("[edittedplace]").number(!0,2,"."," "),$(t).find("[edittedplace]").siblings("strong:hidden").removeAttrib("hidden")),le(t),null!=(null===(b=B)||void 0===b?void 0:b.destroy)&&B.destroy());case 17:case"end":return e.stop()}}),e,this)})))),e.next=32;break;case 31:-1!==[3,4].indexOf(u)&&($(t).addClass("editted"),f=$(t).ddrTooltip({placement:"bottom",tag:"noscroll noopen nouneditted",offset:[-5],minWidth:3==u?"202px":"50px",minHeight:3==u?"176px":"50px",duration:[200,200],trigger:"click",wait:{iconHeight:"40px"},onShow:function(){var e=h(a().mark((function e(r){var n,o,i,c,d,m,b,g,y,x,w;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b=function(e,t){if(!e||!t)return null;var r=v(e.split("."),3),n=r[0],o=r[1],i=r[2],a=v(t.split("."),3),s=a[0],c=a[1],l=a[2];return o>c?"01.".concat(o,".").concat(l):o==c&&s<=n?"".concat(s,".").concat(o,".").concat(i):null},n=r.reference,o=r.popper,r.show,r.hide,r.destroy,i=r.waitDetroy,r.setContent,c=r.setData,r.setProps,d=function(e){var t=$(n).attr("contextedit"),r=t.includes("date_start")?"date_send_action":"date_start",o=$(n).closest("[ddrtabletr]"),i=$(o).find('[contextedit*=",date_report_from,"]').children("p"),a=$(i).attr("edittedplace"),s=$(o).find('[contextedit*=",'+r+',"]'),c=t.includes("date_start")?e:$(s).text().trim().replace("-",""),l=t.includes("date_send_action")?e:$(s).text().trim().replace("-",""),d=b(l,c);d?($(i).setAttrib("date",d),$(i).text(d)):($(i).removeAttrib("date"),$(i).text(a))},m=function(){var e=$(n).attr("contextedit").includes("date_start")?"date_send_action":"date_start",t=$(n).closest("[ddrtabletr]");return $(t).find('[contextedit*=",'+e+',"]').children("p").hasAttr("date")},3!=u){e.next=13;break}return'<div ondblclick="event.stopPropagation();"><div><div id="editCellCalendar"></div></div><div class="mt5px text-end"><div class="button verysmall-button button-light"><button title="Очистить" id="editCellCalendarClear">Очистить</button></div></div></div>',e.next=7,c('<div ondblclick="event.stopPropagation();"><div><div id="editCellCalendar"></div></div><div class="mt5px text-end"><div class="button verysmall-button button-light"><button title="Очистить" id="editCellCalendarClear">Очистить</button></div></div></div>');case 7:g=$(t).find("[edittedplace]").attr("date")||!1,y=ddrDatepicker($(o).find("#editCellCalendar")[0],{startDay:1,defaultView:"calendar",overlayPlaceholder:"Введите год",customDays:["пн","вт","ср","чт","пт","сб","вс"],customMonths:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"],alwaysShow:!0,dateSelected:g?new Date(g):new Date,onSelect:function(){var e=h(a().mark((function e(r,o){var i,c,p,h,v,b,g,y,x,w;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.el,r.destroy,i=o.getFullYear()+"-"+addZero(o.getMonth()+1)+"-"+addZero(o.getDate())+" 00:00:00",c=addZero(o.getDate())+"."+addZero(o.getMonth()+1)+"."+o.getFullYear().toString().substr(-2),p=o.getFullYear().toString().substr(-2)+"."+addZero(o.getMonth()+1)+"."+addZero(o.getDate()),h=$(t).find("[edittedplace]").attr("edittedplace"),v=$(n).ddrWait({iconHeight:"30px",tag:"noscroll noopen edittedwait"}),b={},["date_send_action","date_start"].includes(l)&&m()&&(b.date_report_from=p),e.next=10,axiosQuery("post","site/contracts/cell_edit",{contract_id:s,column:l,type:u,data:i,addict_colums:b},"json");case 10:g=e.sent,y=g.data,(x=g.error)&&(v.off(),$.notify("Ошибка сохранения ячейки!","error"),console.log(null==x?void 0:x.message,x.errors)),y&&($.notify("Сохранено!"),$(t).find("[edittedplace]").setAttrib("date",i),$(t).find("[edittedplace]").text(c||h),["date_send_action","date_start"].includes(l)&&m()&&d(c),v.destroy(),le(t),null===(w=f)||void 0===w||w.destroy());case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),$("#editCellCalendarClear").one(tapEvent,h(a().mark((function e(){var r,o,i,c,p,h,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=$(n).ddrWait({iconHeight:"30px",tag:"noscroll noopen edittedwait"}),o={},["date_send_action","date_start"].includes(l)&&(o.date_report_from=null,d(null)),i=$(t).find("[edittedplace]").attr("edittedplace"),e.next=5,axiosQuery("post","site/contracts/cell_edit",{contract_id:s,column:l,type:u,data:null,addict_colums:o},"json");case 5:c=e.sent,p=c.data,(h=c.error)&&(r.off(),$.notify("Ошибка сохранения ячейки!","error"),console.log(null==h?void 0:h.message,h.errors)),p&&($.notify("Сохранено!"),$(t).find("[edittedplace]").removeAttrib("date"),$(t).find("[edittedplace]").text(i),r.destroy(),le(t),null===(v=f)||void 0===v||v.destroy());case 10:case"end":return e.stop()}}),e)})))),$(y.el).siblings(".qs-datepicker-container").addClass("qs-datepicker-container-noshadow qs-datepicker-container-relative "),e.next=22;break;case 13:return e.next=15,axiosQuery("get","site/contracts/cell_edit",{contract_id:s,column:l,type:u,addict_colums:{}},"json");case 15:return x=e.sent,w=x.data,x.error,x.status,x.headers,e.next=22,c(w);case 22:i(),$("#contractsList").one("scroll",(function(){var e;null!=(null===(e=f)||void 0===e?void 0:e.destroy)&&f.destroy()})),$(o).find("[edittedlistvalue]").one(tapEvent,h(a().mark((function e(){var r,n,o,i,c,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.on(),n=$(this).attr("edittedlistvalue"),o=$(t).find("[edittedplace]").attr("edittedplace"),e.next=5,axiosQuery("post","site/contracts/cell_edit",{contract_id:s,column:l,type:u,data:n,addict_colums:{}},"json");case 5:i=e.sent,c=i.data,(d=i.error)&&(p.off(),$.notify("Ошибка сохранения ячейки!","error"),console.log(null==d?void 0:d.message,d.errors)),$.notify("Сохранено!"),c&&/<\w+/.test(c)?$(t).find("[edittedplace]").html(c||o):$(t).find("[edittedplace]").text(c||o),p.destroy(),le(t),null===(r=f)||void 0===r||r.destroy();case 14:case"end":return e.stop()}}),e,this)}))));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),onDestroy:function(){$(t).removeAttrib("tooltiped")}}));case 32:p.off();case 33:case"end":return e.stop()}}),e)})))()}},{name:"Экспорт в Excel",visible:ce&&!ee,countLeft:ce>1?ce:null,sort:8,onClick:function(){return h(a().mark((function e(){var r,n,o,i,s,c,l,d,u,f,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=function(){$("#excelColumsList").find("[columtoxeport]:checked").length?$("#exportContractsData").ddrInputs("enable"):$("#exportContractsData").ddrInputs("disable")},r=t.items,e.next=4,ddrPopup({title:"Экспорт данных в Excel",width:400,buttons:["ui.cancel",{title:"Экспорт",variant:"blue",action:"exportContractsData",id:"exportContractsData"}]});case 4:return n=e.sent,n.state,o=n.popper,i=n.wait,n.setTitle,n.setButtons,n.loadData,s=n.setHtml,n.setLHtml,n.dialog,c=n.close,n.query,n.onScroll,n.disableButtons,n.enableButtons,n.setWidth,i(),e.next=23,axiosQuery("get","site/contracts/to_export");case 23:return l=e.sent,d=l.data,u=l.error,l.status,l.headers,u&&($.notify("Ошибка! Не удалось открыть окно настроек экспорта!","error"),console.log(null==u?void 0:u.message,u.errors)),e.next=31,s(d);case 31:i(!1),f=!1,$.selectAllChecks=function(){$("#excelColumsList").find("[columtoxeport]").ddrInputs("checked",!f),f=!f,p()},$("#excelColumsList").find("[columtoxeport]").on("change",(function(){p()})),$.exportContractsData=h(a().mark((function e(){var t,n,s,l,d,u,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(),t=[],$(o).find("[columtoxeport]:checked").each((function(e,r){var n=$(r).attr("columtoxeport");t.push(n)})),n=ddrStore("site-contracts-sortfield")||"id",s=ddrStore("site-contracts-sortorder")||"ASC",e.next=6,axiosQuery("post","site/contracts/to_export",{contracts_ids:r,colums:t,sort:n,order:s},"blob");case 6:if(l=e.sent,d=l.data,l.error,l.status,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==(u=l.headers)["content-type"]){e.next=15;break}return $.notify("Ошибка экспорта данных","error"),i(!1),e.abrupt("return");case 15:f=ddrDateBuilder(),exportFile({data:d,headers:u,filename:"Договоры_"+f.day.zero+"."+f.month.zero+"."+f.year.full},(function(){c()}));case 17:case"end":return e.stop()}}),e)})));case 36:case"end":return e.stop()}}),e)})))()}},{name:"Копировать",visible:ee,disabled:!!$(W.pointer).closest("[ddrtabletd]").find("[edittedblock]").length&&!getSelectionStr(),sort:1,onClick:function(){return h(a().mark((function e(){var t,r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:getSelectionStr()?(copyStringToClipboard(getSelectionStr()),$.notify("Скопировано!",{autoHideDelay:2e3})):(t=null,r="",$("#contractsTable").find("[ddrtabletd][copied]").each((function(e,n){0==e&&(t=$(n).closest("[ddrtabletr]")[0]),e>0&&t!==$(n).closest("[ddrtabletr]")[0]?(t=$(n).closest("[ddrtabletr]")[0],r+="\n"):e>0&&(r+="\t"),r+=$(n).find("[edittedplace]").text()})),(n=r.trim())&&(copyStringToClipboard(n),$.notify("Скопировано!",{autoHideDelay:2e3})));case 1:case"end":return e.stop()}}),e)})))()}},{name:function(){return 1==ce?N?"Открепить договор":"Закрепить договор":-1!==[-1,0].indexOf(Q)?"Закрепить договоры":"Открепить договоры"},countLeft:ce>1?ce:null,visible:Z&&!ee,sort:3,onClick:function(){return h(a().mark((function e(){var t,r,n,o,i,s,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=N?"Открепление":"Закрепление",r=N?"открепления ":"закрепления ",n=processNotify(q(ce,t+" # %...",["договора","договоров","договоров"])),e.next=5,axiosQuery("put","site/contracts/pin",{contracts_ids:re,stat:Q},"json");case 5:o=e.sent,i=o.data,s=o.error,o.status,o.headers,s&&(console.log(null==s?void 0:s.message,s.errors),n.error({message:"Ошибка "+r+q(ce,t+" # %...",["договора","договоров","договоров"])})),i&&(c='<i class="fz10px fa-solid fa-thumbtack fa-rotate-by color-gray-600" style="--fa-rotate-angle: -40deg;" noscroll title="Закрепить договор"> </i>',ce>1?$.each(Object.keys(re),(function(e,t){var r=$("#contractsTable").find('[contractid="'+t+'"]');N?$(r).find("[pinnedicon]").empty():$(r).find("[pinnedicon]").html(c),G(r,18,1==N?"0":"1")})):(N?$(W.selector).find("[pinnedicon]").empty():$(W.selector).find("[pinnedicon]").html(c),G(18,1==N?"0":"1")),n.done({message:"Готово!"}));case 12:case"end":return e.stop()}}),e)})))()}},{name:"Выделить цветом",visible:Z&&!ee,countLeft:ce>1?ce:null,sort:4,load:{url:"site/contracts/colorselections",method:"get",map:function(e){return{name:e.name,colorLeft:{color:e.color,radius:"circle",size:"2rem-5px"},visible:!0,onClick:function(r){return h(a().mark((function r(){var n,o,i;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,axiosQuery("post","site/contracts/colorselections",{contractIds:t.items,colorId:e.id},"json");case 2:n=r.sent,o=n.data,i=n.error,n.status,n.headers,i&&($.notify("Ошибка применеия цвета!","error"),console.log(null==i?void 0:i.message,i.errors)),o&&(ce>1?($.each(t.items,(function(e,t){$("#contractsTable").find('[contractid="'+t+'"]').find("[ddrtabletd][commonlist]").css("background-color",o.color||"")})),$.notify("Цвет выделенных договоров успешно применен!")):($(W.selector).find("[ddrtabletd][commonlist]").css("background-color",o.color||""),$.notify("Цвет договора успешно применен!")));case 9:case"end":return r.stop()}}),r)})))()}}}}},{name:"Редактирование Актов",visible:Z&&E&&$(W.selector).hasAttr("contractselected")&&ce&&!ee,countLeft:ce>1?ce:null,countOnArrow:!0,sort:9,onClick:function(){return h(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ddrPopup({title:"Редактирование "+q(ce," # %",["акта","актов","актов"]),width:600,buttons:["Закрыть",{title:"Применить",action:"setEditActs",disabled:1}]}).then((function(e){e.state;var r=e.wait,n=(e.setTitle,e.setButtons,e.loadData,e.setHtml),o=(e.setLHtml,e.dialog,e.close),i=(e.onScroll,e.disableButtons,e.enableButtons);e.setWidth;r(),axiosQuery("get","site/contracts/edit_acts").then((function(e){var t=e.data,o=e.error;e.status,e.headers;if(o)return $.notify("Не удалось загрузить форму!","error"),void console.log(null==o?void 0:o.message,null==o?void 0:o.errors);i(!0),n(t,(function(){r(!1)}))})).catch((function(e){console.log(e)})),$.setEditActs=function(){r();var e=$("#editActsForm").ddrForm();axiosQuery("post","site/contracts/edit_acts",u({contracts_ids:t.items},e)).then((function(n){var i=n.data,a=n.error;n.status,n.headers;if(a)return $.notify("Не удалось сохранить данные!","error"),console.log(null==a?void 0:a.message,null==a?void 0:a.errors),void r(!1);i&&o(),ce&&($.each(t.items,(function(t,r){var n=$("#contractsTable").find('[contractid="'.concat(r,'"]'));$(n).find('[editacts="date_send_action"]').find("[edittedplace]").text(null!=e&&e.date_send_action?null==e?void 0:e.date_send_action.replace(/(\d{4})/,(function(e){return e.slice(2)})).replaceAll("-","."):"-"),$(n).find('[editacts="count_ks_2"]').find("[edittedplace]").text((null==e?void 0:e.count_ks_2)||"-"),$(n).find('[editacts="act_pir"]').find("[edittedplace]").html(null!=e&&e.act_pir?'<i class="fa-solid fa-circle-check color-green fz16px"></i>':"")})),$.notify(q(ce," %",["Акт успешно отредактирован","Акты успешно отредактированы"])))})).catch((function(e){console.log(e)}))}}));case 1:case"end":return e.stop()}}),e)})))()}},{name:"Выгрузка по шаблону",visible:ce&&!ee,countLeft:ce>1?ce:null,countOnArrow:!0,sort:10,onClick:function(){return h(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ddrPopup({title:"Шаблоны для выгрузки",width:500,buttons:["Закрыть"]}).then(function(){var e=h(a().mark((function e(r){var n,o,i,s,c,l,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.state,n=r.wait,r.setTitle,r.setButtons,r.loadData,o=r.setHtml,r.setLHtml,r.dialog,r.close,i=r.onClose,r.onScroll,r.disableButtons,s=r.enableButtons,r.setWidth,n(),e.next=4,axiosQuery("get","site/contracts/export_act",{contract_id:m});case 4:if(c=e.sent,l=c.data,d=c.error,c.status,c.headers,!d){e.next=14;break}return $.notify("Не загрузить данные!","error"),console.log(null==d?void 0:d.message,null==d?void 0:d.errors),n(!1),e.abrupt("return");case 14:return e.next=16,o(l);case 16:s(!0),$("[choosetemplateid]").on(tapEvent,function(){var e=h(a().mark((function e(r){var o,s,c,l,d,u,f,p,h,v,m,g,y,x,w,_,C,k;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=$(r.currentTarget).attr("choosetemplateid"),s=$(r.currentTarget).hasAttr("ranged"),c=$("#contractsCard").ddrWait({bgColor:"#ffffffe6",iconHeight:"50px"}),l=c.destroy,i((function(){l()})),o){e.next=5;break}return $.notify("Ошибка выгрузки! Шаблон не найден","error"),e.abrupt("return");case 5:if(n(),!s){e.next=28;break}return e.next=9,axiosQuery("post","site/contracts/export_act",{contract_id:t.items,template_id:o,ranged:s},"blob");case 9:if(d=e.sent,u=d.data,f=d.error,d.status,p=d.headers,!f){e.next=20;break}return $.notify("Не удалось загрузить данные! Возможно, не загружен файл шаблона.","error"),console.log(null==f?void 0:f.message,null==f?void 0:f.errors),n(!1),l(),e.abrupt("return");case 20:if(p["x-export-filename"]){e.next=25;break}return $.notify("Не удалось загрузить данные! Возможно, не загружен файл шаблона.","error"),n(!1),l(),e.abrupt("return");case 25:$.ddrExport({data:u,headers:p,filename:p["x-export-filename"]||p["export-filename"]},(function(){l()})),e.next=74;break;case 28:h=!1,v=!1,e.prev=30,g=b(t.items);case 32:return e.next=34,g.next();case 34:if(!(h=!(y=e.sent).done)){e.next=58;break}return x=y.value,e.next=38,axiosQuery("post","site/contracts/export_act",{contract_id:[x],template_id:o},"blob");case 38:if(w=e.sent,_=w.data,C=w.error,w.status,k=w.headers,!C){e.next=49;break}return $.notify("Не удалось загрузить данные! Возможно, не загружен файл шаблона.","error"),console.log(null==C?void 0:C.message,null==C?void 0:C.errors),n(!1),l(),e.abrupt("return");case 49:if(k["x-export-filename"]){e.next=54;break}return $.notify("Не удалось загрузить данные! Возможно, не загружен файл шаблона.","error"),n(!1),l(),e.abrupt("return");case 54:$.ddrExport({data:_,headers:k,filename:k["x-export-filename"]||k["export-filename"]},(function(){l()}));case 55:h=!1,e.next=32;break;case 58:e.next=64;break;case 60:e.prev=60,e.t0=e.catch(30),v=!0,m=e.t0;case 64:if(e.prev=64,e.prev=65,!h||null==g.return){e.next=69;break}return e.next=69,g.return();case 69:if(e.prev=69,!v){e.next=72;break}throw m;case 72:return e.finish(69);case 73:return e.finish(64);case 74:n(!1);case 75:case"end":return e.stop()}}),e,null,[[30,60,64,74],[65,,69,73]])})));return function(t){return e.apply(this,arguments)}}());case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()}}]}}function x(){var e,t,r,n,o,i=!1,a=[];function s(){var o;o=$("#contractsTable").find("[ddrtabletd][commonlist]"),$(o).find("[edittedplace].select-text").removeClass("select-text"),$(o).removeAttrib("copied"),$(o).removeClass("selected");var i=Math.min(e,t),s=Math.max(e,t),c=Math.min(r,n),l=Math.max(r,n);a=[];for(var d=i;d<=s;d++)for(var u=$("#contractsTable").find("[ddrtabletr]").eq(d),f=c;f<=l;f++)a.push($(u).find("[ddrtabletd][commonlist]").eq(f)[0]);!function(e){if(!(e=e.filter((function(e){return!!e}))).length)return;$(e).addClass("selected"),$(e).setAttrib("copied")}(a)}function c(e){var t=$(e).index();return-1!==[0,-1].indexOf(t)?t:t-o>0?t-o:0}$("#contractsTable").on("mousedown",(function(a){var l=metaKeys(a),d=(l.isShiftKey,l.isCtrlKey,l.isCommandKey,l.isAltKey),u=(l.isOptionKey,l.noKeys,l.isActiveKey,mouseClick(a)),f=u.isLeftClick,p=(u.isRightClick,u.isCenterClick,$(a.target).closest("[ddrtabletd]")),h=$(a.target).closest("[ddrtabletr]");d&&$(a.target).hasAttr("noselectcell")||(o=$(p).prevAll(":not([ddrtabletd])").length,f&&(d?(i=!0,n=c(p),t=$(h).index(),r&&e?($(p).find("[edittedplace].select-text").removeClass("select-text"),removeSelection(),-1===c(p)&&-1===$(h).index()||(n!==c(p)&&(n=c(p)),t!==$(h).index()&&(t=$(h).index()),s())):(r=c(p),e=$(h).index(),$(p).find("[edittedplace]:not(.select-text)").addClass("select-text"),s())):(r=n=null,e=t=null,s())),$(this).one("mouseup",(function(){i=!1})))})),$("#contractsTable").on("mousemove.contentSelection",(function(e){var r=mouseClick(e),o=r.isLeftClick,a=(r.isRightClick,r.isCenterClick,metaKeys(e)),l=(a.isShiftKey,a.isCtrlKey,a.isCommandKey,a.isAltKey);a.isOptionKey,a.noKeys,a.isActiveKey,$(e.target).closest("[ddrtabletd][commonlist]");if(o&&l&&i){var d=$(e.target).closest("[ddrtabletd]"),u=$(e.target).closest("[ddrtabletr]");l&&-1!==c(d)&&-1!==$(u).index()&&(-1!==c(d)&&n!==c(d)||-1!==$(u).index()&&t!==$(u).index())&&(n!==c(d)&&(n=c(d)),t!==$(u).index()&&(t=$(u).index()),s())}})),ddrCopy((function(){var e=null,t="";$("#contractsTable").find("[ddrtabletd][copied]").each((function(r,n){0==r&&(e=$(n).closest("[ddrtabletr]")[0]),r>0&&e!==$(n).closest("[ddrtabletr]")[0]?(e=$(n).closest("[ddrtabletr]")[0],t+="\n"):r>0&&(t+="\t"),t+=$(n).find("[edittedplace]").text()}));var r=t.trim();r&&(copyStringToClipboard(r),$.notify("Скопировано!",{autoHideDelay:2e3}))}),(function(){return!!$("#contractsTable").find("[ddrtabletd].selected").length}))}function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function k(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){C(i,n,o,a,s,"next",e)}function s(e){C(i,n,o,a,s,"throw",e)}a(void 0)}))}}function S(e,t,r,n){ddrPopup({title:"Подборки договоров",width:1e3,buttons:["Закрыть",{action:"selectionAdd",title:"Создать подборку"}],disabledButtons:!0,winClass:"ddrpopup_white"}).then(function(){var t=k(a().mark((function t(o){var i,s,c,l,d,u,f;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.state,i=o.wait,o.setTitle,o.setButtons,o.loadData,s=o.setHtml,o.setLHtml,c=o.dialog,l=o.close,o.query,o.onScroll,o.disableButtons,d=o.enableButtons,o.setWidth,i(),u="site.section.contracts.render.selections",t.next=5,axiosQuery("get","site/selections/init",{views:u});case 5:if(!(f=t.sent).error){t.next=10;break}return console.log(f.error),i(!1),t.abrupt("return",!1);case 10:s(f.data,(function(){$("#selectionsList").ddrWait({iconHeight:"26px",bgColor:"#ffffffd6"}),$.ddrCRUD({container:"#selectionsList",itemToIndex:"[ddrtabletr]",route:"site/selections",viewsPath:u}).then((function(t){t.error,t.list;var o,s=t.changeInputs,f=t.create,p=(t.store,t.storeWithShow),h=t.update,v=t.destroy,m=t.remove,b=t.query;t.getParams;$("#selectionsTable").blockTable("buildTable"),i(!1),d(!0),s({"[save], [update]":"enable"}),$("#selectionsList").find('[ddrtabletr][archive="1"]').setAttrib("hidden"),$.changeSelectionsList=function(e,t,r){"archive"==r?($("#selectionsList").find("[ddrtabletr][archive]:not([hidden])").setAttrib("hidden"),$("#selectionsList").find('[ddrtabletr][archive="1"]').removeAttrib("hidden")):"active"==r&&($("#selectionsList").find("[ddrtabletr][archive]:not([hidden])").setAttrib("hidden"),$("#selectionsList").find('[ddrtabletr][archive="0"]').removeAttrib("hidden"))},$.selectionAdd=function(e){var t=$(e).ddrWait({iconHeight:"18px",bgColor:"#ffffff91"});f((function(e,r,n){var o=n.error;t.destroy(),o&&$.notify(o.message,"error"),e&&$(r).append(e),$("#selectionsTable").blockTable("buildTable")}))},$.selectionSave=function(e){var t=$(e).closest("[ddrtabletr]"),r=$(t).ddrWait({iconHeight:"26px",bgColor:"#ffffffd6"});p(t,(function(e,n,o){var i=o.error;e&&($(t).replaceWith(e),$("#selectionsTable").blockTable("buildTable"),$.notify("Запись успешно сохранена!")),i&&(r.destroy(),$.notify(i.message,"error")),i.errors&&$.each(i.errors,(function(e,r){$(t).find('[name="'+e+'"]').ddrInputs("error",r[0])}))}))},$.selectionUpdate=function(e,t){var r=$(e).closest("[ddrtabletr]"),n=$(r).ddrWait({iconHeight:"15px",bgColor:"#ffffff91"});h(t,r,(function(e,t,o){var i=o.error;e&&($(r).find("[update]").ddrInputs("disable"),$(r).find("input, select, textarea").ddrInputs("state","clear"),$.notify("Запись успешно обновлена!")),i&&$.notify(i.message,"error"),i.errors&&$.each(i.errors,(function(e,t){$(r).find('[name="'+e+'"]').ddrInputs("error",t[0])})),n.destroy()}))},$.selectionRemove=function(e,t){var r=$(e).closest("[ddrtabletr]");t?c("Удалить подборку?",{buttons:{"Удалить|red":function(e){(0,e.closeDialog)();var n=$(r).ddrWait({iconHeight:"15px",bgColor:"#ffffff91"});v(t,(function(e){e?(m(r),$.notify("Запись успешно удалена!")):$.notify("Ошибка удаления записи!","error"),n.destroy()}))},"Отмена|light":function(e){(0,e.closeDialog)()}}}):m(r)},$.selectionUnsubscribe=function(e,t){if(t){var r=$(e).closest("[ddrtabletr]");c("Отписаться от подборки?",{buttons:{"Отписаться|red":function(e){(0,e.closeDialog)();var n=$(r).ddrWait({iconHeight:"15px",bgColor:"#ffffff91"});b({method:"post",route:"unsubscribe",data:{id:t},responseType:"json"},(function(e,t,o){var i=o.error;o.status,o.headers;i?$.notify("Ошибка отписки от подборки!","error"):(m(r),$.notify("Отписка успешно выполнена!")),n.destroy()}))},"Отмена|light":function(e){(0,e.closeDialog)()}}})}else $.notify("Ошибка! Не удалось отписаться!","error")},$.selectionSendMessages=function(e,t){$(e).ddrInputs("disable");var r=new AbortController;c('<strong class="d-block mb5px">Сообщение:</strong>\t\t\t\t\t\t\t\t<div class="textarea normal-textarea w40rem" id="sendMessDialogField">\t\t\t\t\t\t\t\t\t<textarea name="" rows="5" class="w100"></textarea>\t\t\t\t\t\t\t\t</div>',{buttons:{"Отправить":function(n){var o=n.closeDialog,i=$("#sendMessDialogField").ddrWait();$("#ddrpopupDialogBtn0").ddrInputs("disable");var a=$("#sendMessDialogField").find("textarea").val();axiosQuery("put","site/contracts/chats",{selectionId:t,message:a},"json",r).then((function(t){var r=t.data,n=t.error;t.status,t.headers;n?$.notify("Ошибка отправки сообщений!","error"):r?(-1==r?$.notify("Подборка не содержит в себе ни одного договора! Сообщение не было разослано!","info"):$.notify("Сообщение успешно отправлено во все чаты договоров!"),o(),$(e).ddrInputs("enable")):($.notify("Не удалось отправить сообщение в чаты договоров!","error"),i.destroy())})).catch((function(e){console.log(e)}))},"Отмена|red":function(t){var n=t.closeDialog;$(e).ddrInputs("enable"),n(),r.abort()}},callback:function(){$("#ddrpopupDialogBtn0").ddrInputs("disable");var e=!0;$("#sendMessDialogField").ddrInputs("change",(function(t){$(t).val()&&e?($("#ddrpopupDialogBtn0").ddrInputs("enable"),e=!1):$(t).val()||e||($("#ddrpopupDialogBtn0").ddrInputs("disable"),e=!0)}))}})},$.selectionShare=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];$(e).ddrTooltip({cls:"w30rem",placement:"left-start",offset:[-5,5],tag:"noscroll",minWidth:"360px",minHeight:"200px",maxHeight:"400px",duration:[200,200],trigger:"click",wait:{iconHeight:"40px"},onShow:function(e){e.reference;var n=e.popper,i=(e.show,e.hide,e.destroy),a=e.waitDetroy,s=(e.setContent,e.setData);e.setProps;o=n,i,b({method:"get",route:"users_to_share",data:{views:u,selection_id:t,subscribed:r},responseType:"text"},(function(e,t,r){var n=r.error;r.status,r.headers;n&&($.notify(null==n?void 0:n.message,"error"),console.log(null==n?void 0:n.errors)),s(e),a()}))}}),$.shareSelection=function(e,t,r,n){var i=$(o).ddrWait({iconHeight:"25px"});b({method:"post",route:"share",data:{type:e,unitId:r,selectionId:t,permission:n}},(function(t,r,n){var o=n.error;n.status,n.headers;if(o)return $.notify("Ошибка отправки подборки!","error"),void i.destroy();-1!==["clone-user","clone-user-department"].indexOf(e)?$.notify("Подборка успешно отправлена!"):$.notify("Подписка успешно оформлена!"),i.destroy()}))}},$.selectionBuildList=function(t,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;$("[selectionsbtn]").ddrInputs("disable"),l(),e.value=o,null;var a=$(t).closest("[ddrtabletr]").find('input[name="title"]').val()||$(t).closest("[ddrtabletr]").find("p").text();r(),n({canEditSelection:i,withCounts:!0,callback:function(){$("#currentSelectionTitle").text(a),$("[selectionsbtn]").ddrInputs("enable"),$("#currentSelection").removeAttrib("hidden")}})},$.selectionBuildToEdit=function(t,o){$("[selectionsbtn]").ddrInputs("disable"),l(),e.value=o,!0;var i=$(t).closest("[ddrtabletr]").find('input[name="title"]').val();r(),n({withCounts:!0,callback:function(){$("#currentSelectionTitle").text(i),$("[selectionsbtn]").ddrInputs("enable"),$("#currentSelection").removeAttrib("hidden")}})},$.selectionExport=function(){var e=k(a().mark((function e(t,r){var n,o,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(t).closest("[ddrtabletr]"),$(t).setAttrib("disabled"),n=$(t).ddrWait({iconHeight:"16px",bgColor:"#d2fafb99"}),o=$("[ddrpopupdata]").outerHeight()-100,e.next=6,axiosQuery("get","site/contracts/to_export",{height:(o<300?300:o)+"px"});case 6:i=e.sent,s=i.data,i.error,i.status,i.headers,c('<div class="w38rem text-start"><h6 class="fz16px color-blue mb1rem text-center" style="color:#487c91;">Экспорт данных в Excel</h6>'+s+"</div>",{buttons:{"Отмена|light":function(e){(0,e.closeDialog)(),n.destroy()},"Экспорт|blue":function(){var e=k(a().mark((function e(t){var o,i,s,c,l,d,u,f,p;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.closeDialog,i=$("[ddrpopupdialogwin]").ddrWait({iconHeight:"25px"}),s=[],$("[ddrpopupdialogwin]").find("[columtoxeport]:checked").each((function(e,t){var r=$(t).attr("columtoxeport");s.push(r)})),c=ddrStore("site-contracts-sortfield")||"id",l=ddrStore("site-contracts-sortorder")||"ASC",e.next=7,axiosQuery("post","site/contracts/to_export",{selection_id:r,colums:s,sort:c,order:l},"blob");case 7:if(d=e.sent,u=d.data,d.error,d.status,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"==(f=d.headers)["content-type"]){e.next=16;break}return $.notify("Ошибка экспорта данных","error"),i.off(),e.abrupt("return");case 16:p=ddrDateBuilder(),exportFile({data:u,headers:f,filename:"Договоры_подборки_"+p.day.zero+"."+p.month.zero+"."+p.year.full},(function(){o(),n.destroy()}));case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}},(function(){var e=!1;function t(){$("#excelColumsList").find("[columtoxeport]:checked").length?$("#ddrpopupDialogBtn1").ddrInputs("enable"):$("#ddrpopupDialogBtn1").ddrInputs("disable")}$.selectAllChecks=function(){$("#excelColumsList").find("[columtoxeport]").ddrInputs("checked",!e),e=!e,t()},$("#excelColumsList").find("[columtoxeport]").on("change",(function(){t()}))}));case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),$.selectionToArchive=function(e,t){var r,n=$(e).ddrWait({iconHeight:"15px",bgColor:"#ffffff91"});$(e).ddrInputs("disable");var o,i=1==$(e).closest("[ddrtabletr]").attr("archive"),s=i?"from":"to",l=i?"Подборка успешно возвращена в активные!":"Подборка успешно отправлена в архив!";c(i?"Вернуть подборку в активные?":"Отправить подборку в архив?",{buttons:(r={},w(r,i?"Вернуть":"Отправить",(o=k(a().mark((function r(o){var c,d,u,f;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=o.closeDialog,r.next=3,axiosQuery("put","site/selections/archive",{id:t,command:s},"json");case 3:d=r.sent,u=d.data,f=d.error,d.status,d.headers,d.abort,f&&($.notify("Ошибка отправки подборки в архив!","error"),console.log(null==f?void 0:f.message,null==f?void 0:f.errors)),u&&($(e).closest("[ddrtabletr]").setAttrib("hidden"),$(e).closest("[ddrtabletr]").attr("archive",i?"0":"1"),i?($(e).parent(".button").removeClass("button-light").addClass("button-purple"),$(e).html('<i class="fa-solid fa-fw fa-box-archive"></i>')):($(e).parent(".button").removeClass("button-purple").addClass("button-light"),$(e).html('<i class="fa-solid fa-fw fa-arrow-rotate-left"></i>')),c(),$.notify(l),n.destroy(),$(e).ddrInputs("enable"));case 11:case"end":return r.stop()}}),r)}))),function(e){return o.apply(this,arguments)})),w(r,"Отмена|red",(function(t){var r=t.closeDialog;n.destroy(),$(e).ddrInputs("enable"),r()})),r)})}}))}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!e)return null;var t=e.replace(/ООО|ИП|ЗАО|МБУ|АО Торговый дом|АО|МКУ|ГБУ|СНТ|Глава|КФХ/g,"").replace(/"/g,"").trim().replace(/\s+/g," "),r=t.split(" ");return r[0]||null}},5666:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),a=new T(n||[]);return i._invoke=function(e,t,r){var n=u;return function(o,i){if(n===p)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===u)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var c=d(e,t,r);if("normal"===c.type){if(n=r.done?h:f,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=h,r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u="suspendedStart",f="suspendedYield",p="executing",h="completed",v={};function m(){}function b(){}function g(){}var $={};c($,i,(function(){return this}));var y=Object.getPrototypeOf,x=y&&y(y(L([])));x&&x!==r&&n.call(x,i)&&($=x);var w=g.prototype=m.prototype=Object.create($);function _(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function r(o,i,a,s){var c=d(e[o],e,i);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function k(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method))return v;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=d(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function L(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:I}}function I(){return{value:t,done:!0}}return b.prototype=g,c(w,"constructor",g),c(g,"constructor",b),b.displayName=c(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},_(C.prototype),c(C.prototype,a,(function(){return this})),e.AsyncIterator=C,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new C(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},_(w),c(w,s,"Generator"),c(w,i,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=L,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:L(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},2504:function(e,t,r){var n={"./site/contracts/index.js":305};function o(e){var t=i(e);return r(t)}function i(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=i,e.exports=o,o.id=2504}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},window.loadSectionScripts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_.isEmpty(e))throw Error("loadSectionScripts -> не переданы параметры!");var t=_.assign({guard:"site",section:null},e),n=t.guard,o=t.section;if(_.isNull(o))throw Error("loadSectionScripts -> не указан параметр section");var i=r(2504)("./"+n+"/"+o+"/index.js");return i}}();